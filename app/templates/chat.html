{% extends "base.html" %}
{% set body_class = 'chat-body' %}
{% block title %}Chat - {{ room.name }}{% endblock %}
{% block content %}
<div class="chat-layout">

  <!-- SIDEBAR -->
  <aside class="sidebar glass">
    <div class="sidebar-top">
      <div class="sidebar-actions">
        <span class="dots"><i></i><i></i><i></i></span>
        <h2>Chats</h2>
      </div>
      <form class="newchat" action="{{ url_for('main.create_room') }}" method="post">
        <input class="newchat-input" name="room_name" placeholder="Nombre de la conversaciÃ³n">
        <button class="btn btn-primary small" type="submit">âž•</button>
      </form>
      <input class="search-bar" placeholder="Buscar chat...">
    </div>

    <div class="chat-list">
      {% for r in rooms %}
        <a class="chat-item {% if r.id == room.id %}active{% endif %}" href="{{ url_for('main.chat', room_id=r.id) }}">
          <div class="chat-info">
            <span class="chat-name">{{ r.name }}</span>
            <span class="chat-msg">{% if r.id == room.id %}Abierto{% else %}&nbsp;{% endif %}</span>
          </div>
          <span class="chat-time">â†’</span>
        </a>
      {% endfor %}
    </div>

    <!-- PERFIL ABAJO -->
    <div class="sidebar-footer">
      <div class="profile-card">
        <img src="{{ current_user.avatar_url or 'https://i.pravatar.cc/100' }}" alt="">
        <div class="pinfo">
          <div class="pname">{{ current_user.name }}</div>
          <div class="pmail">{{ current_user.email }}</div>
        </div>
        <a class="pbtn" title="Perfil" href="{{ url_for('main.perfil') }}">âš™</a>
      </div>
    </div>
  </aside>

  <!-- PANEL DERECHO -->
  <section class="chat-main">
    <!-- Header de la conversaciÃ³n -->
    <div class="chat-header">
      <div class="peer">
        <img class="avatar" src="https://i.pravatar.cc/120?u={{ room.id }}" alt="">
        <div>
          <h3>{{ room.name }}</h3>
          <div class="chat-status">Activo hace 1 min</div>
        </div>
      </div>
      <div class="tools">
        <button class="icon" title="Llamada">ðŸ“ž</button>
        <button class="icon" title="Video">ðŸŽ¥</button>
        <button class="icon" title="Buscar">ðŸ”Ž</button>
      </div>
    </div>

    <!-- Historial -->
    <div id="messages" class="chat-messages">
      {% for m in messages %}
        <div class="message {% if m.user.id == current_user.id %}sent{% else %}received{% endif %}">
          <strong>{{ m.user.name }}</strong>
          <span class="timestamp">[{{ m.created_at.strftime("%H:%M") }}]</span>
          <div>{{ m.body }}</div>
        </div>
      {% endfor %}
    </div>

    <!-- Input -->
    <form id="message-form" class="chat-input">
      <input id="message-input" placeholder="Escribe un mensaje..." autocomplete="off">
      <button type="submit">Enviar</button>
    </form>
  </section>
</div>

<!-- Boot sin Jinja en <script> -->
<div id="boot" data-uid="{{ current_user.id }}" data-room="{{ room.id }}"></div>
{% endblock %}
